

































<title>Percona Monitoring and Management &mdash; Version 2 advisor checks for PMM 2.28 and newer</title>

<head>
    


    
<script src="../../js/version-select.js" type="text/javascript"></script>

<script src="../../js/toctree.js" type="text/javascript"></script>

<script src="../../js/lightgallery.min.js" type="text/javascript"></script>


<script>
    var elements = document.getElementsByClassName("lightgallery");
    for(var i=0; i<elements.length; i++) {
       lightGallery(elements[i]);
    }
</script>

    <link rel="top" title="" href="https://www.percona.com/percona-monitoring-and-management/2.x" />
    
    <link rel="next" title="Dashboards" href="../dashboards/index.html" />
    
    
</head>

<body>
    <div class="container">
        
<link rel="stylesheet" href="../../css/version-select.css" type="text/css">
<link rel="stylesheet" href="../../css/toctree.css" type="text/css">

        
<script src="../../js/version-select.js" type="text/javascript"></script>

<script src="../../js/toctree.js" type="text/javascript"></script>

<script src="../../js/lightgallery.min.js" type="text/javascript"></script>


<script>
    var elements = document.getElementsByClassName("lightgallery");
    for(var i=0; i<elements.length; i++) {
       lightGallery(elements[i]);
    }
</script>

        <div class="document row">
            <div class="documentwrapper col-md-9 col-md-push-3">
                
<div class="related row">
    <ul class="nav nav-pills">
        
        <li class="right" style="margin-right: 10px">
            <a href="../dashboards/index.html" title="Dashboards">Next</a>
        </li>
        
        
        <li class="right" style="margin-right: 10px">
            <a href="checks-v1.html" title="Version 1 checks for PMM 2.27 and older">Previous</a>
        </li>
        
        <li>
            <a href="https://www.percona.com/percona-monitoring-and-management/2.x">Home</a>
        </li>
    </ul>
</div>

                

<div class="small">
    <ul class="list-inline">
        <li class="pull-right">
            <a href="https://github.com/percona/pmm-doc/edit/main/docs/details/develop-checks/checks-v2.md" target="_blank" title=""><i class="uil uil-pen"></i> <b>Edit this page</b></a>
        </li>
    </ul>
</div>


                <div class="bodywrapper">
                    <div class="body">
                        <h1 id="version-2-advisor-checks-for-pmm-228-and-newer">Version 2 advisor checks for PMM 2.28 and newer<a class="headerlink" href="#version-2-advisor-checks-for-pmm-228-and-newer" title="Permanent link">&para;</a></h1>
<p>PMM 2.28 upgraded Advisor Checks to version 2, which uses a slightly different structure than version 1 checks, created in 2.7 and older. This is because, compared to version 1 checks, checks created in 2.28 and later offer additional support for: </p>
<ul>
<li>Multiple queries</li>
<li>Victoria Metrics as a data source</li>
<li>Database <strong>Family</strong> field </li>
</ul>
<h2 id="format-for-v2-checks">Format for v.2 checks<a class="headerlink" href="#format-for-v2-checks" title="Permanent link">&para;</a></h2>
<p>Advisor checks for PMM 2.28 and later use the following format:</p>
<details class="note alert alert-info">
<summary>Version 2 Checks Format</summary>
<div class="highlight"><pre><span></span><code><span class="nn">---</span><span class="w"></span>
<span class="nt">checks</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exampleV2</span><span class="w"></span>
<span class="w">    </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check format V2</span><span class="w"></span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checks something important</span><span class="w"></span>
<span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">standard</span><span class="w"></span>
<span class="w">    </span><span class="nt">family</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL</span><span class="w"></span>
<span class="w">    </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configuration</span><span class="w"></span>
<span class="w">    </span><span class="nt">queries</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_SHOW</span><span class="w"></span>
<span class="w">        </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VARIABLES</span><span class="w"></span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">METRICS_INSTANT</span><span class="w"></span>
<span class="w">        </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql_global_status_uptime{service_name=~&quot;{{.ServiceName}}&quot;}</span><span class="w"></span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">METRICS_INSTANT</span><span class="w"></span>
<span class="w">        </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql_global_status_uptime{service_name=~&quot;{{.ServiceName}}&quot;}</span><span class="w"></span>
<span class="w">        </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">lookback</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span><span class="w"></span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">METRICS_RANGE</span><span class="w"></span>
<span class="w">        </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">avg by (node_name) (avg_over_time(node_load1{node_name=~&quot;{{.NodeName}}&quot;}[5m]))</span><span class="w"></span>
<span class="w">        </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">range</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15m</span><span class="w"></span>
<span class="w">          </span><span class="nt">step</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span><span class="w"></span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">METRICS_RANGE</span><span class="w"></span>
<span class="w">        </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">avg by (node_name) (avg_over_time(node_load1{node_name=~&quot;{{.NodeName}}&quot;}[5m]))</span><span class="w"></span>
<span class="w">        </span><span class="nt">parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">lookback</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span><span class="w"></span>
<span class="w">          </span><span class="nt">range</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15m</span><span class="w"></span>
<span class="w">          </span><span class="nt">step</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span><span class="w"></span>

<span class="w">    </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">      </span><span class="no">def check_context(docs, context):</span><span class="w"></span>
<span class="w">          </span><span class="no"># `docs` is a frozen (deeply immutable) list where each item represents single query results. Order of results</span><span class="w"></span>
<span class="w">          </span><span class="no"># matches order of queries in check file. Each query result is list of dicts where each item where each dict</span><span class="w"></span>
<span class="w">          </span><span class="no"># represents a single document in result set.</span><span class="w"></span>
<span class="w">          </span><span class="no">#</span><span class="w"></span>
<span class="w">          </span><span class="no"># `context` is a dict with additional functions.</span><span class="w"></span>
<span class="w">          </span><span class="no">#</span><span class="w"></span>
<span class="w">          </span><span class="no"># Global `print` and `fail` functions are available.</span><span class="w"></span>
<span class="w">          </span><span class="no">#</span><span class="w"></span>
<span class="w">          </span><span class="no"># `check_context` function is expected to return a list of dicts that are then converted to alerts;</span><span class="w"></span>
<span class="w">          </span><span class="no"># in particular, that list can be empty.</span><span class="w"></span>
<span class="w">          </span><span class="no"># Any other value (for example, string) is treated as script execution failure</span><span class="w"></span>
<span class="w">          </span><span class="no"># (Starlark does not support Python exceptions);</span><span class="w"></span>
<span class="w">          </span><span class="no"># it is recommended to use global function `fail` for that instead.</span><span class="w"></span>

<span class="w">          </span><span class="no">results = []</span><span class="w"></span>

<span class="w">          </span><span class="no">for row in docs[0]:</span><span class="w"></span>
<span class="w">              </span><span class="no">name, value = row[&quot;Variable_name&quot;], row[&quot;Value&quot;]</span><span class="w"></span>
<span class="w">              </span><span class="no">if name == &quot;version&quot;:</span><span class="w"></span>
<span class="w">                  </span><span class="no">results.append({</span><span class="w"></span>
<span class="w">                      </span><span class="no">&quot;summary&quot;: &quot;MySQL has version {}&quot;.format(value),</span><span class="w"></span>
<span class="w">                      </span><span class="no">&quot;description&quot;: &quot;Current version is {}&quot;.format(value),</span><span class="w"></span>
<span class="w">                      </span><span class="no">&quot;read_more_url&quot;: &quot;&quot;,</span><span class="w"></span>
<span class="w">                      </span><span class="no">&quot;severity&quot;: &quot;warning&quot;,</span><span class="w"></span>
<span class="w">                      </span><span class="no">&quot;labels&quot;: {},</span><span class="w"></span>
<span class="w">                  </span><span class="no">})</span><span class="w"></span>

<span class="w">          </span><span class="no">uptimeNow = int(int(docs[1][0][&quot;value&quot;][1])/60)</span><span class="w"></span>
<span class="w">          </span><span class="no">results.append({</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;summary&quot;: &quot;MySQL uptime {} min&quot;.format(uptimeNow),</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;description&quot;: &quot;Current uptime is {} min&quot;.format(uptimeNow),</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;read_more_url&quot;: &quot;&quot;,</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;severity&quot;: &quot;warning&quot;,</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;labels&quot;: {},</span><span class="w"></span>
<span class="w">          </span><span class="no">})</span><span class="w"></span>

<span class="w">          </span><span class="no">uptimeFiveMinAgo = int(int(docs[2][0][&quot;value&quot;][1])/60)</span><span class="w"></span>
<span class="w">          </span><span class="no">results.append({</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;summary&quot;: &quot;MySQL uptime 5 min ago was {} min&quot;.format(uptimeFiveMinAgo),</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;description&quot;: &quot;5 min ago uptime was {} min&quot;.format(uptimeFiveMinAgo),</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;read_more_url&quot;: &quot;&quot;,</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;severity&quot;: &quot;warning&quot;,</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;labels&quot;: {},</span><span class="w"></span>
<span class="w">          </span><span class="no">})</span><span class="w"></span>

<span class="w">          </span><span class="no">dataPoints = []</span><span class="w"></span>
<span class="w">          </span><span class="no">for row in docs[3][0][&quot;values&quot;]:</span><span class="w"></span>
<span class="w">            </span><span class="no">dataPoints.append(row[1])</span><span class="w"></span>

<span class="w">          </span><span class="no">results.append({</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;summary&quot;: &quot;Node has load average for last 15 minutes {}&quot;.format(dataPoints),</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;description&quot;: &quot;Data points {}&quot;.format(dataPoints),</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;read_more_url&quot;: &quot;&quot;,</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;severity&quot;: &quot;warning&quot;,</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;labels&quot;: {},</span><span class="w"></span>
<span class="w">          </span><span class="no">})</span><span class="w"></span>

<span class="w">          </span><span class="no">dataPoints = []</span><span class="w"></span>
<span class="w">          </span><span class="no">for row in docs[4][0][&quot;values&quot;]:</span><span class="w"></span>
<span class="w">              </span><span class="no">dataPoints.append(row[1])</span><span class="w"></span>

<span class="w">          </span><span class="no">results.append({</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;summary&quot;: &quot;Five minutes ago node had load average for 15 minutes {}&quot;.format(dataPoints),</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;description&quot;: &quot;Data points {}&quot;.format(dataPoints),</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;read_more_url&quot;: &quot;&quot;,</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;severity&quot;: &quot;warning&quot;,</span><span class="w"></span>
<span class="w">              </span><span class="no">&quot;labels&quot;: {},</span><span class="w"></span>
<span class="w">          </span><span class="no">})</span><span class="w"></span>

<span class="w">          </span><span class="no">return results</span><span class="w"></span>
</code></pre></div>
</details>
<h2 id="checks-script">Checks script<a class="headerlink" href="#checks-script" title="Permanent link">&para;</a></h2>
<p>The check script assumes that there is a function with <strong>check_context</strong>, that accepts a <em>list</em> where each item represents result of a single query specified in check. Each result itself is a <em>list</em> of <em>docs</em> containing returned rows for SQL databases and documents for MongoDB. It returns zero, one, or several check results that are then converted to alerts.</p>
<h2 id="check-severity-levels">Check severity levels<a class="headerlink" href="#check-severity-levels" title="Permanent link">&para;</a></h2>
<p>You can label your advisor checks with one of the following available severity levels: <strong>Emergency</strong>, <strong>Alert</strong>, <strong>Critical</strong>, <strong>Error</strong>, <strong>Warning</strong>, <strong>Notice</strong>, <strong>Info</strong>, <strong>Debug</strong>.
PMM groups failed checks by their severity, and displays them under <strong>Advisors Checks &gt; Failed Checks</strong>. </p>
<h2 id="check-fields">Check fields<a class="headerlink" href="#check-fields" title="Permanent link">&para;</a></h2>
<p>Checks can include the following fields:</p>
<ul>
<li><strong>Version</strong> (integer, required): defines what other properties are expected, what types are supported, what is expected from the script and what it can expect from the execution environment, etc.</li>
<li><strong>Name</strong> (string, required): defines machine-readable name (ID).</li>
<li><strong>Summary</strong> (string, required): defines short human-readable description.</li>
<li><strong>Description</strong> (string, required): defines long human-readable description.</li>
<li>
<p><strong>Interval</strong> (string/enum, optional): defines running interval. Can be one of the predefined intervals in the UI: Standard, Frequent, Rare.</p>
</li>
<li>
<p><strong>Script</strong> (string, required): contains a small Starlark program that processes query results, and returns check results. It is executed on the PMM Server side.</p>
</li>
<li><strong>Family</strong> (string, required): specifies one of the supported database families: MYSQL, POSTGRESQL, MONGODB. This field is only available for Advisor checks v.2, created for PMM 2.28 and later.</li>
<li><strong>Category</strong> (string, required): specifies a custom or a default advisor check category. For example: Performance, Security. </li>
<li><strong>Queries</strong> (array, required): contains items that specify queries.</li>
<li><strong>Type</strong> (string/enum, required): defines the query type. Check the list of available types in the table below. </li>
<li><strong>Query</strong> (string, can be absent if the type defines the whole query by itself): The query is executed on the PMM Client side and can contain multiple queries specific to the target DBMS.</li>
<li><strong>Parameters</strong> (key-value, can be absent if query doesn&rsquo;t have required parameters)</li>
</ul>
<h2 id="query-types">Query types<a class="headerlink" href="#query-types" title="Permanent link">&para;</a></h2>
<p>Expand the table below for the list of checks types that you can use to define your query type and the PMM Service type for which the check will run.</p>
<details class="note alert alert-info">
<summary>Check Types table</summary>
<table class="table">
<thead>
<tr>
<th scope="col">Check type</th>
<th scope="col">Description</th>
<th scope="col">&ldquo;query&rdquo; required (must be empty if &ldquo;No&rdquo;)</th>
</tr>
</thead>
<tbody>
<tr>
<td>MYSQL_SHOW</td>
<td>Executes &lsquo;SHOW …&rsquo; clause against MySQL database.</td>
<td>Yes</td>
</tr>
<tr>
<td>MYSQL_SELECT</td>
<td>Executes &lsquo;SELECT …&rsquo; clause against MySQL database.</td>
<td>Yes</td>
</tr>
<tr>
<td>POSTGRESQL_SHOW</td>
<td>Executes &lsquo;SHOW ALL&rsquo; command against PosgreSQL database.</td>
<td>No</td>
</tr>
<tr>
<td>POSTGRESQL_SELECT</td>
<td>Executes &lsquo;SELECT …&rsquo; clause against PosgreSQL database.</td>
<td>Yes</td>
</tr>
<tr>
<td>MONGODB_GETPARAMETER</td>
<td>Executes db.adminCommand( { getParameter: &ldquo;*&rdquo; } ) against MongoDB&rsquo;s &ldquo;admin&rdquo; database. For more information, see <a href="https://docs.mongodb.com/manual/reference/command/getParameter/">getParameter</a></td>
<td>No</td>
</tr>
<tr>
<td>MONGODB_BUILDINFO</td>
<td>Executes db.adminCommand( { buildInfo:  1 } ) against MongoDB&rsquo;s &ldquo;admin&rdquo; database. For more information, see <a href="https://docs.mongodb.com/manual/reference/command/buildInfo/">buildInfo</a></td>
<td>No</td>
</tr>
<tr>
<td>MONGODB_GETCMDLINEOPTS</td>
<td>Executes db.adminCommand( { getCmdLineOpts: 1 } ) against MongoDB&rsquo;s &ldquo;admin&rdquo; database. For more information, see <a href="https://docs.mongodb.com/manual/reference/command/getCmdLineOpts/">getCmdLineOpts</a></td>
<td>No</td>
</tr>
<tr>
<td>MONGODB_REPLSETGETSTATUS</td>
<td>Executes db.adminCommand( { replSetGetStatus: 1 } ) against MongoDB&rsquo;s &ldquo;admin&rdquo; database. For more information, see  <a href="https://docs.mongodb.com/manual/reference/command/replSetGetStatus/">replSetGetStatus</a></td>
<td>No</td>
</tr>
<tr>
<td>MONGODB_GETDIAGNOSTICDATA</td>
<td>Executes db.adminCommand( { getDiagnosticData: 1 } ) against MongoDB&rsquo;s &ldquo;admin&rdquo; database. For more information, see <a href="https://docs.mongodb.com/manual/administration/analyzing-mongodb-performance/#full-time-diagnostic-data-capture">MongoDB Performance</a></td>
<td>No</td>
</tr>
<tr>
<td>METRICS_INSTANT</td>
<td>Executes instant <a href="https://docs.victoriametrics.com/MetricsQL.html">MetricsQL</a> query. Query can use placeholders in query string  <strong>{{.NodeName</strong>}} and <strong>{{}}.ServiceName}}</strong>  . Both match target service/node names. To read more about instant queries see <a href="https://prometheus.io/docs/prometheus/latest/querying/api/#instant-queries">Prometheus docs</a>.</td>
<td>Yes</td>
</tr>
<tr>
<td>METRICS_RANGE</td>
<td>Executes range <a href="https://docs.victoriametrics.com/MetricsQL.html">MetricsQL</a> query. Query can use placeholders in query string  <strong>{{.NodeName</strong>}} and <strong>{{}}.ServiceName}}</strong>  . Both match target service/node names. To read more about range queries see <a href="https://prometheus.io/docs/prometheus/latest/querying/api/#range-queries">Prometheus docs</a>.</td>
<td>Yes</td>
</tr>
</tbody>
</table>
</details>
<h2 id="query-parameters">Query parameters<a class="headerlink" href="#query-parameters" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>METRICS_INSTANT</strong></li>
<li><strong>lookback</strong> (duration, optional): specifies how far in past to look back to metrics history. If this parameter is not specified, then query executed on the latest data. Example values: 30s, 5m, 8h.</li>
<li><strong>METRICS_RANGE</strong></li>
<li><strong>lookback</strong> (duration, optional): specifies how far in past to look back to metrics history. If this parameter is not specified, then query executed on the latest data. Example values: 30s, 5m, 8h.</li>
<li><strong>range</strong> (duration, required): specifies time window of the query. This parameter is equal to <a href="https://prometheus.io/docs/prometheus/latest/querying/api/#range-queries">prometheus API</a>.</li>
<li><strong>step</strong> (duration, required): query resolution. This parameter is equal to <a href="https://prometheus.io/docs/prometheus/latest/querying/api/#range-queries">prometheus API</a>.</li>
</ul>
<h2 id="develop-version-2-checks">Develop version 2 checks<a class="headerlink" href="#develop-version-2-checks" title="Permanent link">&para;</a></h2>
<div class="admonition note alert alert-primary">
<p class="admonition-title">Development / Debugging Only</p>
<p>Note that V2 check development in PMM 2.28+ is currently for <strong>debugging only</strong> and <strong>NOT for production use!</strong>  Future releases plan to include the option to run custom local checks in addition to hosted Percona Platform checks. </p>
</div>
<p>To develop custom checks for PMM 2.28 and later: </p>
<ol>
<li>Install the latest PMM Server and PMM Client builds following the <a href="https://www.percona.com/software/pmm/quickstart#">installation instructions</a>. </li>
<li>
<p>Run PMM Server with special environment variables:</p>
<ul>
<li><em>PMM_DEBUG=1</em> to enable debug output that would be useful later;</li>
<li><em>PERCONA_TEST_CHECKS_FILE=/srv/custom-checks.yml</em> to use checks from the local files instead of downloading them from Percona Platform.</li>
<li><em>PERCONA_TEST_CHECKS_DISABLE_START_DELAY=true</em> to disable the default check execution start delay. This is currently set to one minute, so that checks run upon system start.</li>
<li><em>PERCONA_TEST_CHECKS_RESEND_INTERVAL=2s</em> to define the frequency for sending the SA-based alerts to Alertmanager.</li>
</ul>
<div class="highlight"><pre><span></span><code>docker run -p 80:80 -p 443:443 --name pmm-server \
-e PMM_DEBUG=1 \
-e PERCONA_TEST_CHECKS_FILE=/srv/custom-checks.yml \
-e PERCONA_TEST_CHECKS_DISABLE_START_DELAY=true \
-e PERCONA_TEST_CHECKS_RESEND_INTERVAL=2s \
perconalab/pmm-server:dev-latest
</code></pre></div>
</li>
<li>
<p>Log in to Grafana with credentials <strong>admin/admin</strong>.</p>
</li>
<li>
<p>Go to <strong>Configuration &gt; Settings &gt; Advanced Settings</strong> and make sure the <strong>Advisors</strong> option is enabled.</p>
</li>
<li>
<p>Create <em>/srv/custom-checks.yml</em> inside the <code>pmm-server</code> container with the content of your check.</p>
</li>
<li>
<p>The checks will run according to the time interval defined on the UI. You can see the result of running the check on the home dashboard:</p>
<p><div class="lightgallery"><a data-sub-html="" href="../../_images/HomeDashboard.png"><img alt="" src="../../_images/HomeDashboard.png" /></a></div></p>
</li>
<li>
<p>Click on the number of failed checks to open the Failed Checks dashboard:</p>
<p><div class="lightgallery"><a data-sub-html="" href="../../_images/FailedChecks.png"><img alt="" src="../../_images/FailedChecks.png" /></a></div></p>
</li>
<li>
<p>Go into Docker container to output the logs of pmm-managed and read check logs:</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code># get inside the container
docker exec -it pmm-server bash
# print and watch the logs
supervisorctl tail -f pmm-managed
</code></pre></div>
                    </div>
                </div>
                
<div class="small">
    <ul class="list-inline">
        
        <li class="left">
            <i class="uil uil-refresh"></i> Page updated 2022-07-19
        </li>
        
    </ul>
</div>

                
<div class="related row">
    <ul class="nav nav-pills">
        
        <li class="right" style="margin-right: 10px">
            <a href="../dashboards/index.html" title="Dashboards">Next</a>
        </li>
        
        
        <li class="right" style="margin-right: 10px">
            <a href="checks-v1.html" title="Version 1 checks for PMM 2.27 and older">Previous</a>
        </li>
        
        <li>
            <a href="https://www.percona.com/percona-monitoring-and-management/2.x">Home</a>
        </li>
    </ul>
</div>

            </div>
            
<div class="sphinxsidebar col-md-3 col-md-pull-9">
    <div class="sphinxsidebarwrapper">
        {@ product_logo @}
        {@ product_pdf_download @}
        
<section class="select-wrapper" id="version-select-wrapper">
    <!-- Empty locator section for version selector -->
</section>

        <h3 id="toctree-heading"><a href="https://www.percona.com/percona-monitoring-and-management/2.x">Contents</a></h3>
        

<ul class="toctree" id="toctree">


<li class="toctree-l1">
    <a class="reference internal" href="../../index.html">Welcome</a>




<li class="toctree-l1">
    <a class="reference internal" href="../../setting-up/index.html">Setting up</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../setting-up/server/index.html">Server</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/server/network.html">Network</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/server/docker.html">Docker</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/server/podman.html">Podman</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/server/helm.html">Helm</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/server/virtual-appliance.html">Virtual Appliance</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/server/aws.html">AWS Marketplace</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/server/easy-install.html">Easy-install script</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/server/dbaas.html">DBaaS</a>



</ul>





<li class="toctree-l2">
    <a class="reference internal" href="../../setting-up/client/index.html">Client</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/client/mysql.html">MySQL</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/client/mongodb.html">MongoDB</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/client/postgresql.html">PostgreSQL</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/client/proxysql.html">ProxySQL</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/client/aws.html">Amazon RDS</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/client/azure.html">Microsoft Azure</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/client/google.html">Google Cloud Platform</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/client/linux.html">Linux</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/client/external.html">External Services</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/client/haproxy.html">HAProxy</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../setting-up/client/remote.html">Remote instances</a>



</ul>




</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../using/index.html">Using</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../using/interface.html">User Interface</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/alerting.html">Percona Alerting</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/backup.html">Backup and Restore</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/query-analytics.html">Query Analytics</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../using/dbaas.html">DBaaS</a>



</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../how-to/index.html">How to</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/configure.html">Configure</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/manage-users.html">Manage users</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/upgrade.html">Upgrade</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/secure.html">Secure</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/optimize.html">Optimize</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/annotate.html">Annotate</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/share-dashboard.html">Share dashboards and panels</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/extend-metrics.html">Extend Metrics</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/troubleshoot.html">Resolve issues</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../how-to/integrate-platform.html">Integrate with Percona Platform</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../../how-to/account-info.html">Check Percona Portal account information</a>




<li class="toctree-l3">
    <a class="reference internal" href="../../how-to/advisors.html">Work with Advisor checks</a>



</ul>




</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../index.html">Details</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../architecture.html">Architecture</a>




<li class="toctree-l2">
    <a class="reference internal" href="../interface.html">UI components</a>




<li class="toctree-l2">
    <a class="reference internal" href="index.html">Develop checks</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="checks-v1.html">Version 1 checks for PMM 2.27 and older</a>




<li class="toctree-l3">
    <a class="reference internal" href="checks-v2.html">Version 2 advisor checks for PMM 2.28 and newer</a>



</ul>





<li class="toctree-l2">
    <a class="reference internal" href="../dashboards/index.html">Dashboards</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../dashboards/dashboard-manage-dashboards.html">Manage dashboards</a>




<li class="toctree-l3">
    <a class="reference internal" href="javascript: void(0)" style="text-decoration: none">PMM dashboards</a>





<ul class="toctree" id="toctree">


<li class="toctree-l4">
    <a class="reference internal" href="../dashboards/dashboard-home.html">Insight</a>








<li class="toctree-l4">
    <a class="reference internal" href="../dashboards/dashboard-inventory.html">PMM Inventory</a>








<li class="toctree-l4">
    <a class="reference internal" href="../dashboards/dashboard-cluster-summary.html">DBaas</a>




<li class="toctree-l4">
    <a class="reference internal" href="../dashboards/dashboard-cpu-utilization-details.html">OS Dashboards</a>








<li class="toctree-l4">
    <a class="reference internal" href="../dashboards/dashboard-prometheus-exporter-status.html">Prometheus Dashboards</a>








<li class="toctree-l4">
    <a class="reference internal" href="../dashboards/dashboard-mysql-amazon-aurora-details.html">MySQL Dashboards</a>








<li class="toctree-l4">
    <a class="reference internal" href="../dashboards/dashboard-mongodb-experimental_collection_overview.html">MongoDB Dashboards</a>








<li class="toctree-l4">
    <a class="reference internal" href="../dashboards/dashboard-postgresql-instances-overview.html">PostgreSQL Dashboards</a>








<li class="toctree-l4">
    <a class="reference internal" href="../dashboards/dashboard-proxysql-instance-summary.html">ProxySQL Dashboards</a>




<li class="toctree-l4">
    <a class="reference internal" href="../dashboards/dashboard-pxc-galera-node-summary.html">HA Dashboards</a>







</ul>




</ul>





<li class="toctree-l2">
    <a class="reference internal" href="../commands/index.html">Commands</a>




<ul class="toctree" id="toctree">


<li class="toctree-l3">
    <a class="reference internal" href="../commands/pmm-admin.html">pmm-admin - PMM Administration Tool</a>




<li class="toctree-l3">
    <a class="reference internal" href="../commands/pmm-agent.html">pmm-agent - PMM Client agent</a>



</ul>





<li class="toctree-l2">
    <a class="reference internal" href="../api.html">API</a>




<li class="toctree-l2">
    <a class="reference internal" href="../victoria-metrics.html">VictoriaMetrics</a>




<li class="toctree-l2">
    <a class="reference internal" href="../clickhouse.html">ClickHouse</a>




<li class="toctree-l2">
    <a class="reference internal" href="../glossary.html">Glossary</a>



</ul>





<li class="toctree-l1">
    <a class="reference internal" href="../../faq.html">FAQ</a>




<li class="toctree-l1">
    <a class="reference internal" href="../../release-notes/index.html">Release Notes</a>




<ul class="toctree" id="toctree">


<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.31.0.html">PMM 2.31.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.30.0.html">PMM 2.30.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.29.1.html">PMM 2.29.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.29.0.html">PMM 2.29.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.28.0.html">PMM 2.28.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.27.0.html">PMM 2.27.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.26.0.html">PMM 2.26.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.25.0.html">PMM 2.25.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.24.0.html">PMM 2.24.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.23.0.html">PMM 2.23.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.22.0.html">PMM 2.22.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.21.0.html">PMM 2.21.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.20.0.html">PMM 2.20.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.19.0.html">PMM 2.19.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.18.0.html">PMM 2.18.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.17.0.html">PMM 2.17.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.16.0.html">PMM 2.16.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.15.1.html">PMM 2.15.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.15.0.html">PMM 2.15.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.14.0.html">PMM 2.14.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.13.0.html">PMM 2.13.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.12.0.html">PMM 2.12.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.11.1.html">PMM 2.11.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.11.0.html">PMM 2.11.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.10.1.html">PMM 2.10.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.10.0.html">PMM 2.10.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.9.1.html">PMM 2.9.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.9.0.html">PMM 2.9.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.8.0.html">PMM 2.8.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.7.0.html">PMM 2.7.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.6.1.html">PMM 2.6.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.6.0.html">PMM 2.6.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.5.0.html">PMM 2.5.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.4.0.html">PMM 2.4.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.3.0.html">PMM 2.3.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.2.2.html">PMM 2.2.2</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.2.1.html">PMM 2.2.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.2.0.html">PMM 2.2.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.1.0.html">PMM 2.1.0</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.0.1.html">PMM 2.0.1</a>




<li class="toctree-l2">
    <a class="reference internal" href="../../release-notes/2.0.0.html">PMM 2.0.0</a>



</ul>




</ul>


        

<h4>Previous page</h4>
<p class="topless">
    <a href="checks-v1.html" title="previous chapter">Version 1 checks for PMM 2.27 and older</a>
</p>


<h4>Next page</h4>
<p class="topless">
    <a href="../dashboards/index.html" title="next chapter">Dashboards</a>
</p>


        {@ product_series @}
    </div>
</div>

            <div class="clearer"></div>
        </div>
    </div>
</body>