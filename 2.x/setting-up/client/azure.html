
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation">
      
      
        <meta name="author" content="Percona LLC">
      
      
        <link rel="canonical" href="https://pmm-doc.netlify.app/2.x/setting-up/client/azure.html">
      
      <link rel="icon" href="../../_images/percona-favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.3">
    
    
      
        <title>Microsoft Azure - Percona Monitoring and Management</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.edf004c2.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unicons.iconscout.com/release/v3.0.3/css/line.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="../../css/percona.css">
    
      <link rel="stylesheet" href="../../css/lightgallery.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="percona-light" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#microsoft-azure" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Percona Monitoring and Management" class="md-header__button md-logo" aria-label="Percona Monitoring and Management" data-md-component="logo">
      
  <img src="../../_images/percona-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Percona Monitoring and Management
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Microsoft Azure
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/percona/pmm-doc/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    percona/pmm-doc
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Percona Monitoring and Management" class="md-nav__button md-logo" aria-label="Percona Monitoring and Management" data-md-component="logo">
      
  <img src="../../_images/percona-logo.svg" alt="logo">

    </a>
    Percona Monitoring and Management
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/percona/pmm-doc/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    percona/pmm-doc
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        Welcome
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../index.html">Setting up</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Setting up" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Setting up
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../using/index.html">Using</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Using" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Using
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
          
            
          
            
          
            
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../how-to/index.html">How to</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="How to" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          How to
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../details/index.html">Details</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Details" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Details
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faq.html" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../release-notes/index.html">Release Notes</a>
          
            <label for="__nav_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Release Notes" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Release Notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#activate-microsoft-azure" class="md-nav__link">
    Activate Microsoft Azure
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#required-settings" class="md-nav__link">
    Required settings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-a-mysql-instance" class="md-nav__link">
    Setting up a MySQL instance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-an-azure-instance" class="md-nav__link">
    Adding an Azure Instance
  </a>
  
    <nav class="md-nav" aria-label="Adding an Azure Instance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mariadb" class="md-nav__link">
    MariaDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postgresql" class="md-nav__link">
    PostgreSQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-discover-databases-on-azure" class="md-nav__link">
    To discover databases on Azure
  </a>
  
    <nav class="md-nav" aria-label="To discover databases on Azure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-the-subscription-id" class="md-nav__link">
    Get the subscription ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-new-application-to-get-the-tenant-id-client-id-and-the-client-secret" class="md-nav__link">
    Create a new application to get the tenant ID, client ID and the client secret.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-an-azure-instance-on-pmm-client-side" class="md-nav__link">
    Adding an Azure Instance on pmm-client side
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/percona/pmm-doc/edit/main/docs/setting-up/client/azure.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="microsoft-azure">Microsoft Azure<a class="headerlink" href="#microsoft-azure" title="Permanent link">&para;</a></h1>
<div class="admonition caution alert alert-warning">
<p class="admonition-title">Caution</p>
<p>Microsoft Azure functionality is currently in <a href="../details/glossary.md#technical-preview">technical preview</a> and is subject to change.</p>
</div>
<h2 id="activate-microsoft-azure">Activate Microsoft Azure<a class="headerlink" href="#activate-microsoft-azure" title="Permanent link">&para;</a></h2>
<p>The Microsoft Azure feature is turned off by default. To turn it on:</p>
<ol>
<li>
<p>Go to <i class="uil uil-cog"></i> <em>Configuration</em> → <i class="uil uil-setting"></i> <em>Settings</em> → <em>Advanced Settings</em>.</p>
</li>
<li>
<p>Click the <i class="uil uil-toggle-off"></i> toggle in the <em>Technical preview features</em> section of the page.</p>
</li>
</ol>
<h2 id="required-settings">Required settings<a class="headerlink" href="#required-settings" title="Permanent link">&para;</a></h2>
<p>It is possible to use PMM for monitoring <a href="https://azure.microsoft.com">Azure</a> database instances like other remote instances. In this case, the PMM Client is not installed on the host where the database server is deployed. By using the PMM web interface, you connect to the Azure DB instance. Discovery is not yet implemented in PMM but it is possible to add known instances by providing the connection parameters.</p>
<p>First of all, ensure that there is the minimal latency between PMM Server and the Azure instance.</p>
<p>Second, add a firewall rule to enable access from PMM Client like this:</p>
<p><div class="lightgallery"><a data-sub-html="image" href="../../_images/azure-firewall.png"><img alt="image" src="../../_images/azure-firewall.png" /></a></div></p>
<h2 id="setting-up-a-mysql-instance">Setting up a MySQL instance<a class="headerlink" href="#setting-up-a-mysql-instance" title="Permanent link">&para;</a></h2>
<p>Query Analytics requires you to configure <em>Performance Schema</em> as the query source, because the slow query log is stored on the Azure side, and QAN agent is not able to read it.  Enable the <code>performance_schema</code> option under <code>Parameter Groups</code> in Azure MySQL databases.</p>
<p>When adding a monitoring instance for Azure, specify a unique name to distinguish it from the local MySQL instance.  If you do not specify a name, it will use the client’s host name.</p>
<p>Create the <code>pmm</code> user with the following privileges on the Azure MySQL database instance that you want to monitor:</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span> <span class="k">USER</span> <span class="s1">&#39;pmm&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">&#39;pass&#39;</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">SELECT</span><span class="p">,</span> <span class="n">PROCESS</span><span class="p">,</span> <span class="n">REPLICATION</span> <span class="n">CLIENT</span> <span class="k">ON</span> <span class="o">*</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">&#39;pmm&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">USER</span> <span class="s1">&#39;pmm&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span> <span class="k">WITH</span> <span class="n">MAX_USER_CONNECTIONS</span> <span class="mi">10</span><span class="p">;</span>
</code></pre></div>
<h2 id="adding-an-azure-instance">Adding an Azure Instance<a class="headerlink" href="#adding-an-azure-instance" title="Permanent link">&para;</a></h2>
<p>Follow the instructions for remotes instances explained <a href="aws.html">here</a>, Azure MySQL databases are similar to AWS RDS databases.</p>
<p>Example:</p>
<p><div class="lightgallery"><a data-sub-html="image" href="../../_images/azure-add-mysql-1.png"><img alt="image" src="../../_images/azure-add-mysql-1.png" /></a></div></p>
<p>and be sure to set <em>Performance Schema</em> as the query collection method for Query Analytics.</p>
<p><div class="lightgallery"><a data-sub-html="image" href="../../_images/azure-add-mysql-2.png"><img alt="image" src="../../_images/azure-add-mysql-2.png" /></a></div></p>
<h3 id="mariadb">MariaDB<a class="headerlink" href="#mariadb" title="Permanent link">&para;</a></h3>
<p>MariaDB up to version 10.2 works out of the box but starting with MariaDB 10.3 instrumentation is disabled by default and cannot be enabled since there
is no SUPER role in Azure-MariaDB. So, it is not possible to run the required queries to enable instrumentation. Monitoring will work but Query Analytics
won&rsquo;t receive any query data.</p>
<h3 id="postgresql">PostgreSQL<a class="headerlink" href="#postgresql" title="Permanent link">&para;</a></h3>
<p>For PostgreSQL follow the same methods used for MySQL and MariaDB and enable <code>track_io_timing</code> in the instance configuration to enable Query Analytics.</p>
<p><div class="lightgallery"><a data-sub-html="image" href="../../_images/azure-postgresql-config.png"><img alt="image" src="../../_images/azure-postgresql-config.png" /></a></div></p>
<p>For Query Analytics, set the server parameter:</p>
<div class="highlight"><pre><span></span><code><span class="na">pg_stat_statements.track</span> <span class="o">=</span> <span class="s">all</span>
</code></pre></div>
<h2 id="to-discover-databases-on-azure">To discover databases on Azure<a class="headerlink" href="#to-discover-databases-on-azure" title="Permanent link">&para;</a></h2>
<p>You need to get the Client ID, Client Secret, Tenant ID and Subscription ID.</p>
<h3 id="get-the-subscription-id">Get the subscription ID<a class="headerlink" href="#get-the-subscription-id" title="Permanent link">&para;</a></h3>
<ol>
<li>Search <strong>Subscriptions</strong>, click on your susbcription name
<div class="lightgallery"><a data-sub-html="" href="../../_images/azure_subscription_section.png"><img alt="" src="../../_images/azure_subscription_section.png" /></a></div></li>
<li>Copy the susbcription ID
<div class="lightgallery"><a data-sub-html="" href="../../_images/azure_subscription_id.png"><img alt="" src="../../_images/azure_subscription_id.png" /></a></div></li>
</ol>
<h3 id="create-a-new-application-to-get-the-tenant-id-client-id-and-the-client-secret">Create a new application to get the tenant ID, client ID and the client secret.<a class="headerlink" href="#create-a-new-application-to-get-the-tenant-id-client-id-and-the-client-secret" title="Permanent link">&para;</a></h3>
<ol>
<li>Search for <strong>Azure Active Directory</strong>
<div class="lightgallery"><a data-sub-html="" href="../../_images/azure_active_directory_section.png"><img alt="" src="../../_images/azure_active_directory_section.png" /></a></div></li>
<li>Register a new application
<div class="lightgallery"><a data-sub-html="" href="../../_images/azure_app_registrations_section.png"><img alt="" src="../../_images/azure_app_registrations_section.png" />
</a></div><div class="lightgallery"><a data-sub-html="" href="../../_images/azure_app_new_registration.png"><img alt="" src="../../_images/azure_app_new_registration.png" />
</a></div><div class="lightgallery"><a data-sub-html="" href="../../_images/azure_app_new_details.png"><img alt="" src="../../_images/azure_app_new_details.png" /></a></div></li>
<li>At this point you can copy the client and tenant IDs.
<div class="lightgallery"><a data-sub-html="" href="../../_images/azure_app_client_tenant.png"><img alt="" src="../../_images/azure_app_client_tenant.png" /></a></div></li>
<li>Create an application secret.
<div class="lightgallery"><a data-sub-html="" href="../../_images/azure_app_secret_01.png"><img alt="" src="../../_images/azure_app_secret_01.png" />
</a></div><div class="lightgallery"><a data-sub-html="" href="../../_images/azure_app_secret_02.png"><img alt="" src="../../_images/azure_app_secret_02.png" />
</a></div><div class="lightgallery"><a data-sub-html="" href="../../_images/azure_app_secret_03.png"><img alt="" src="../../_images/azure_app_secret_03.png" /></a></div></li>
<li>Copy the <strong>value</strong> of the application secret. Once you leave this page you won&rsquo;t be able to see the secret again and you will have to generate a new
   one.
<div class="lightgallery"><a data-sub-html="" href="../../_images/azure_app_secret_04.png"><img alt="" src="../../_images/azure_app_secret_04.png" /></a></div></li>
<li>
<p>Give API access permissions to your application.</p>
<p>6.1. Search for <strong>Subscriptions</strong> like in step 1.</p>
<p>6.2. Select your aplication and grant <strong>Monitor Reader</strong> permissions. This might require you have admin permissions in your Azure account.</p>
</li>
</ol>
<p><div class="lightgallery"><a data-sub-html="" href="../../_images/azure_app_permissions_01.png"><img alt="" src="../../_images/azure_app_permissions_01.png" />
</a></div><div class="lightgallery"><a data-sub-html="" href="../../_images/azure_app_permissions_02.png"><img alt="" src="../../_images/azure_app_permissions_02.png" />
</a></div><div class="lightgallery"><a data-sub-html="" href="../../_images/azure_app_permissions_03.png"><img alt="" src="../../_images/azure_app_permissions_03.png" />
</a></div><div class="lightgallery"><a data-sub-html="" href="../../_images/azure_app_permissions_04.png"><img alt="" src="../../_images/azure_app_permissions_04.png" /></a></div></p>
<p>When you fill in all fields press the <em>Discover</em> button and you will see a list of available databases for monitoring.</p>
<p><div class="lightgallery"><a data-sub-html="" href="../../_images/PMM_Add_Instance_Azure_2.png"><img alt="" src="../../_images/PMM_Add_Instance_Azure_2.png" /></a></div></p>
<p>You can monitor 6 types of databases:</p>
<ul>
<li><code>Microsoft.DBforMySQL/servers</code></li>
<li><code>Microsoft.DBforMySQL/flexibleServers</code></li>
<li><code>Microsoft.DBforMariaDB/servers</code></li>
<li><code>Microsoft.DBforPostgreSQL/servers</code></li>
<li><code>Microsoft.DBforPostgreSQL/flexibleServers</code></li>
<li><code>Microsoft.DBforPostgreSQL/serversv2</code></li>
</ul>
<p>You can find more details on how to create DB on Azure at:</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/postgresql/">https://docs.microsoft.com/en-us/azure/postgresql/</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/mysql/">https://docs.microsoft.com/en-us/azure/mysql/</a></li>
</ul>
<div class="admonition hint alert alert-success">
<p class="admonition-title">Tip</p>
<p>You must set <code>pg_stat_statements.track = all</code> in your PostgreSQL Server settings to use PMM Query Analytics. (<a href="postgresql.html#pg_stat_statements">Read more.</a>)</p>
</div>
<p><div class="lightgallery"><a data-sub-html="" href="../../_images/PMM_Add_Instance_Azure_3.png"><img alt="" src="../../_images/PMM_Add_Instance_Azure_3.png" /></a></div></p>
<p>In the list of databases on the Discovery page click <em>Start Monitoring</em> to add the selected Azure Database to PMM.</p>
<p>Fill in all required fields and click <em>Add service</em>.</p>
<p><div class="lightgallery"><a data-sub-html="" href="../../_images/PMM_Add_Instance_Azure_4.png"><img alt="" src="../../_images/PMM_Add_Instance_Azure_4.png" /></a></div></p>
<p>PMM can use 3 exporters to collect metrics:</p>
<ul>
<li>
<p>Azure Metrics Exporter – collect &ldquo;system&rdquo; metrics related to DB.</p>
<ul>
<li><code>node_cpu_average</code></li>
<li><code>azure_resource_info</code></li>
<li><code>node_filesystem_size_bytes</code></li>
<li><code>azure_memory_percent_average</code></li>
<li><code>azure_storage_percent_average</code></li>
<li><code>azure_storage_used_bytes_average</code></li>
<li><code>node_network_receive_bytes_total</code></li>
<li><code>node_network_transmit_bytes_total</code></li>
</ul>
</li>
<li>
<p><code>mysql_exporter</code> or <code>postgres_exporter</code> – to collect database related metrics.</p>
</li>
<li>
<p>PMM Agent to collect queries related metrics using <a href="postgresql.html#pg_stat_statements"><code>pg_stat_statements</code></a> for PostgreSQL or Performance Schema for MySQL (MariaDB)</p>
</li>
</ul>
<h3 id="adding-an-azure-instance-on-pmm-client-side">Adding an Azure Instance on pmm-client side<a class="headerlink" href="#adding-an-azure-instance-on-pmm-client-side" title="Permanent link">&para;</a></h3>
<p>TLS/SSL is enforced on the server by default. So please download the certificate needed to communicate over SSL with your Azure Database.
It can be done on Networking tab for your Azure Database instance.</p>
<p><div class="lightgallery"><a data-sub-html="" href="../../_images/azure_certificate.png"><img alt="" src="../../_images/azure_certificate.png" /></a></div></p>
<p>Also enforced TLS/SSL connection option can be disabled on server side.</p>
<p>Command for adding an azure database service for monitoring without TLS/SSL.</p>
<div class="highlight"><pre><span></span><code>pmm-admin add mysql --username<span class="o">=</span>azureuser --password<span class="o">=</span>secure --host<span class="o">=</span>azuremysql.mysql.database.azure.com --service-name<span class="o">=</span>azure1 --query-source<span class="o">=</span>perfschema
</code></pre></div>
<p>Downloaded certificate is named <code>DigiCertGlobalRootCA.crt.pem</code>.</p>
<p>An example of the command for adding an Azure database service for monitoring with TLS/SSL would be:</p>
<div class="highlight"><pre><span></span><code>pmm-admin add mysql --username<span class="o">=</span>azureuser --password<span class="o">=</span>secure --host<span class="o">=</span>azuremysql.mysql.database.azure.com --service-name<span class="o">=</span>azure1 --query-source<span class="o">=</span>perfschema --tls --tls-ca<span class="o">=</span>DigiCertGlobalRootCA.crt.pem --tls-cert<span class="o">=</span>client-cert.pem --tls-key<span class="o">=</span>client-key.pem --tls-skip-verify
</code></pre></div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      2021-11-24
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="aws.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Amazon RDS" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Amazon RDS
            </div>
          </div>
        </a>
      
      
        
        <a href="google.html" class="md-footer__link md-footer__link--next" aria-label="Next: Google Cloud Platform" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Google Cloud Platform
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Percona LLC, &#169; 2021
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.0bbba5b5.min.js", "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.e1a181d9.min.js"></script>
      
        <script src="../../js/version-select.js"></script>
      
        <script src="../../js/toctree.js"></script>
      
        <script src="../../js/lightgallery.min.js"></script>
      
    
  </body>
</html>